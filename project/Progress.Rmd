---
title: "Project"
author: "Mengxiao"
date: "2019/10/27"
output: pdf_document
---

```{r}
library(dplyr)
library(tidyr)
library(maps)

data <- read.csv('https://scads.eecs.wsu.edu/wp-content/uploads/2017/10/AM_strains_clean.csv', fileEncoding='utf-16', na.string = '?', sep='\t')
```
```{r echo=false}
location_levels = levels(data$Location.1)
location_levels = location_levels[2:length(location_levels)]

for (i in levels(data$Location.2)){
  if (i %in% location_levels){
    next
  }
  if (i == ''){
    next
  }
  location_levels[length(location_levels)+1] = i
}

for (i in levels(data$Location.3)){
  if (i %in% location_levels){
    next
  }
  if (i == ''){
    next
  }
  location_levels[length(location_levels)+1] = i
}
for (i in levels(data$Location.4)){
  if (i %in% location_levels){
    next
  }
  if (i == ''){
    next
  }
  location_levels[length(location_levels)+1] = i
}
for (i in levels(data$Location.5)){
  if (i %in% location_levels){
    next
  }
  if (i == ''){
    next
  }
  location_levels[length(location_levels)+1] = i
}
```
```{r}
location_levels
```
```{r}
mydata = data.frame(location_levels)
mydata$sets = rep(0, times=length(mydata))
for (i in 1:nrow(mydata)){
  mydata$sets[i] = 0
  for (j in 1:nrow(data)){
    temp = data[j,]
    if ((temp$Location.1 == location_levels[i]) | (temp$Location.2 == location_levels[i]) | (temp$Location.3 == location_levels[i]) |
        (temp$Location.4 == location_levels[i]) | (temp$Location.5 == location_levels[i])){
          mydata$sets[i] = mydata$sets[i]+1
        }
  }
}
mydata = mydata %>% 
  separate(location_levels, into=c("y", "x"), sep=",")
mydata$longitude = as.numeric(mydata$x)
mydata$latitude = as.numeric(mydata$y)
keys = c("longitude", "latitude", "sets")
mydata = mydata[keys]
mydata$country <- map.where('world', mydata$longitude, mydata$latitude)
mydata = mydata %>% separate(country, into=c("country", "city"), sep=":")
mydata$country[is.na(mydata$country)] <- "philippines"
mydata$country[mydata$country == "Taiwan"] <- "China"
keys[4] = c("country")
mydata = mydata[keys]
```


Start new part! Drawing map to see the locations.
```{r}
library(ggmap)
myLocation <- c(-140, -50, 150, 70)
myMap <- get_map(location=myLocation, source="stamen", maptype="terrain", zoom=3)
ggmap(myMap)+geom_point(aes(x=longitude, y=latitude, size=sets), data=mydata, alpha=0.5, color="darkred")
```